{% extends "base.html" %}
{% block content %}

    <h1 class="display-4" id="top">Your Story and Images are Aligned!</h1>

    {% if num_images %}
        <button type="button" class="btn btn-outline-info">Images <span class="badge badge-info">{{ num_images }}</span></button>
    {% else %}
        <button type="button" class="btn btn-outline-secondary">Images <span class="badge badge-info">{{ num_images }}</span></button>
    {% endif %}

    {% if num_texts %}
        <button type="button" class="btn btn-outline-info">Paragraphs <span class="badge badge-info">{{ num_texts }}</span></button>
    {% else %}
        <button type="button" class="btn btn-outline-secondary">Paragraphs <span class="badge badge-info">{{ num_texts }}</span></button>
    {% endif %}

    <br>
    <br>

    <nav>
        <div class="nav nav-pills mb-3" id="nav-tab" role="tablist">
            <a class="nav-item nav-link active" id="nav-story-tab" data-toggle="tab"
                href="#nav-story" role="tab" aria-controls="nav-story" aria-selected="true">
                Your Story
            </a>
            <a class="nav-item nav-link" id="analysis-tab" data-toggle="tab"
                href="#analysis" role="tab" aria-controls="analysis" aria-selected="false">
                Story Analysis
            </a>
            <a class="btn nav-item nav-link" id="create-tab"
                href="{{ url_for('index') }}" role="button">
                Create Another Article
            </a>
        </div>
    </nav>

    <hr>

    <div class="tab-content" id="nav-tabContent">

        <!-- Start of Story Tab -->
        <div class="tab-pane fade show active" id="nav-story" role="tabpanel" aria-labelledby="nav-story-tab">
            {% for result in results %}
                {% if result.type %}
                    <img src="data:{{result.type}}};base64,{{result.data}}" style="display: block; margin-left: auto; margin-right: auto; width: 40%;"><br>

                    {% if result.quote %}
                        <p style="font-size: 0.7em; text-align: center;"> {{ result.quote }} </p>
                    {% endif %}

                {% else %}
                    <p> {{ result }} </p>
                {% endif %}
            {% endfor %}

            {% if results %}
                <hr>

                <a href="#top" class="btn btn-primary" role="button">Back to Top</a>
            {% endif %}
        </div>
        <!-- End of Story Tab -->

        <!-- Start of Analysis Tab -->
        <div class="tab-pane fade" id="analysis" role="tabpanel" aria-labelledby="analysis-tab">

            <table class="table table-striped table-responsive text-center">
                {% if cosine_similarities %}
                    <thead>
                        <tr>
                            <th scope="col">image name</th>
                            {% for text_index in range(1, num_texts+1) %}
                                <th scope="col">Para {{ text_index }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for image_name, cosines in cosine_similarities.items() %}
                            <tr>
                                <th scope="row">{{ image_name }}</th>
                                {% for cosine in cosines %}
                                    <td>{{ cosine }}</td>
                                {% endfor %}
                            </tr>
                        {% endfor %}
                    </tbody>
                {% else %}
                    <thead>
                        <tr><th scope="col">No cosine similarities are available</th></tr>
                    </thead>
                {% endif %}
            </table>

            <table class="table table-striped table-responsive text-center">
                {% if topk_concepts %}
                    <thead>
                        <tr>
                            <th scope="col">image name</th>
                            <th scope="col">concepts</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for image_name, concepts in topk_concepts.items() %}
                            <tr>
                                <th scope="row">{{ image_name }}</th>
                                <td>{{ concepts }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                {% else %}
                    <thead>
                        <tr><th scope="col">No concepts are available</th></tr>
                    </thead>
                {% endif %}
            </table>

        </div>
        <!-- End of Analysis Tab -->
    </div>

{% endblock %}